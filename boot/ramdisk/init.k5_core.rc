# Copyright (c) 2009-2012, Code Aurora Forum. All rights reserved.
#
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions are met:
#     * Redistributions of source code must retain the above copyright
#       notice, this list of conditions and the following disclaimer.
#     * Redistributions in binary form must reproduce the above copyright
#       notice, this list of conditions and the following disclaimer in the
#       documentation and/or other materials provided with the distribution.
#     * Neither the name of Code Aurora nor
#       the names of its contributors may be used to endorse or promote
#       products derived from this software without specific prior written
#       permission.
#
# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
# AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
# IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
# NON-INFRINGEMENT ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR
# CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
# EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
# PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;
# OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
# OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
# ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
#

import /init.k5_product.rc
import /init.k5_sensors.rc

# modem logging (LGODL)
import /init.lge.modem_log.rc

# BT_S : [CONBT-720] BDADDR_LOADER
import /init.lge.bt_vendor.rc
# BT_E : [CONBT-720] BDADDR_LOADER

# import init script for zram, which is a subset of project Svelte.
import /init.lge.svelte.rc

on init
# START touch_driver
	chown system system /sys/devices/virtual/input/lge_touch/incoming_call
	chmod 664 /sys/devices/virtual/input/lge_touch/incoming_call
	chown system system /sys/devices/virtual/input/lge_touch/ime_status
	chown system lgkeyguard /sys/devices/virtual/input/lge_touch/keyguard
	chmod 664 /sys/devices/virtual/input/lge_touch/keyguard
	chown system system /sys/devices/virtual/input/lge_touch/debug_tool
	chmod 664 /sys/devices/virtual/input/lge_touch/debug_tool
	chown system system /sys/devices/virtual/input/lge_touch/debug_option
	chmod 664 /sys/devices/virtual/input/lge_touch/debug_option
	chown system system /sys/devices/virtual/input/lge_touch/onhand
	chmod 664 /sys/devices/virtual/input/lge_touch/onhand
# END touch_driver

# START External Display Watch
	chown system system /sys/devices/virtual/ext_watch/config_fontonoff
	chmod 664 /sys/devices/virtual/ext_watch/config_fontonoff
	chown system system /sys/devices/virtual/ext_watch/config_fontdata
	chmod 664 /sys/devices/virtual/ext_watch/config_fontdata
	chown system system /sys/devices/virtual/ext_watch/config_fonteffect
	chmod 664 /sys/devices/virtual/ext_watch/config_fonteffect
	chown system system /sys/devices/virtual/ext_watch/config_fontproperty
	chmod 664 /sys/devices/virtual/ext_watch/config_fontproperty
	chown system system /sys/devices/virtual/ext_watch/config_fontposition
	chmod 664 /sys/devices/virtual/ext_watch/config_fontposition
	chown system system /sys/devices/virtual/ext_watch/config_timesync
	chmod 664 /sys/devices/virtual/ext_watch/config_timesync
	chown system system /sys/devices/virtual/ext_watch/query_fontdata
	chmod 664 /sys/devices/virtual/ext_watch/query_fontdata
	chown system system /sys/devices/virtual/ext_watch/query_fontposition
	chmod 664 /sys/devices/virtual/ext_watch/query_fontposition
	chown system system /sys/devices/virtual/ext_watch/query_timesync
	chmod 664 /sys/devices/virtual/ext_watch/query_timesync
	chown system system /sys/devices/virtual/ext_watch/query_fontcolor
	chmod 664 /sys/devices/virtual/ext_watch/query_fontcolor
	chown system system /sys/devices/virtual/ext_watch/query_fonteffect
	chmod 664 /sys/devices/virtual/ext_watch/query_fonteffect
# END External Display Watch

# improving first Touch response by spi active
	write /sys/devices/soc.0/78b9000.spi/power/control on

# START touch_knock_on
	chown system system /sys/devices/virtual/input/lge_touch/lpwg_data
	chmod 664 /sys/devices/virtual/input/lge_touch/lpwg_data
	chown system system /sys/devices/virtual/input/lge_touch/lpwg_notify
	chmod 664 /sys/devices/virtual/input/lge_touch/lpwg_notify
	chown system system /sys/devices/virtual/input/lge_touch/quick_cover_status
	chmod 664 /sys/devices/virtual/input/lge_touch/quick_cover_status
# END touch_knock_on

# Begin AOD Display New Feature
    chown system system /sys/class/graphics/fb0/aod
    chmod 664 /sys/class/graphics/fb0/aod
    chown system system /sys/class/graphics/fb0/keep_aod
    chmod 664 /sys/class/graphics/fb0/keep_aod
    chown system system /sys/class/graphics/fb0/cur_panel_mode
    chmod 644 /sys/class/graphics/fb0/cur_panel_mode
    chown system system /sys/class/leds/lcd-backlight-ex/brightness
    chmod 664 /sys/class/leds/lcd-backlight-ex/brightness

    chown system system /sys/class/graphics/fb0/toggle_u1
# End AOD Display new Feature

# Begin SRE Display New Feature
    chown system system /sys/class/sre/sre_func/sre_status
    chmod 644 /sys/class/sre/sre_func/sre_status
# End SRE Display New Feature

    #For key_lock ATD command
    chown system system /sys/devices/platform/factory_misc.0/key_lock
    chmod 664 /sys/devices/platform/factory_misc.0/key_lock

# change preload directory permission for movetosd about preload app
    start chmod_dp

#SDCard Encrypt.
    setprop ro.ssbd.session /dev/block/bootdevice/by-name/eksst
    setprop ro.ssbd.offset 0

on fs
# enable exfat feature
    insmod /system/lib/modules/texfat.ko

on post-fs-data
    #bohyun, jung - D3-5T-FS@lge.com, add jobs which should done after mount completed
#single_binary_init

	# To support Hidden Menu
	chown system system /sys/class/power_supply/battery/charging_enabled
	chmod 0644 /sys/class/power_supply/battery/charging_enabled

#[START][LGE_WIFI][COMMON]: TO read WIFI MAC from LGFTM(MISC - block device)
service wififtmd /system/bin/wififtmd
    user root
    group radio system
    disabled
    oneshot

on property:wifi_ftm.wififtmd_start=1
    start wififtmd

on property:wifi_ftm.wififtmd_start=0
    stop wififtmd
#[END][LGE_WIFI][COMMON]: TO read WIFI MAC from LGFTM(MISC - block device)


# load wifi driver
    import init.wifi.rc

# Wi-Fi deamon
 service wcnss-service /system/bin/wcnss_service
    class main
    user system
    group system wifi
    oneshot

service ptt_socket_app /system/bin/ptt_socket_app
    class main
    user system
    group system
    oneshot

service dhcp6cDNS_wlan0 /system/bin/dhcp6c -c "/etc/wide-dhcpv6/dhcp6cDNS.conf" -Df wlan0
    disabled
    oneshot

service dhcp6c_wlan0 /system/bin/dhcp6c -c "/etc/wide-dhcpv6/dhcp6c.conf" -Df wlan0
    disabled
    oneshot

#Customize booting resources
service runtime_boot_res /system/vendor/bin/runtime_boot_res.sh
    disabled
    oneshot

on property:ro.build.sbp=1
    start runtime_boot_res

on post-fs
    start sreadahead

service sreadahead /sbin/treadahead
    oneshot
    disabled
    seclabel u:r:sreadahead:s0

service sreadahead-check /sbin/sreadahead_check
    class main
    user root
    group root
    oneshot
    seclabel u:r:sreadahead-check:s0

on boot
	write /sys/module/lowmemorykiller/parameters/lmk_fast_run 0
	chown system system /sys/class/leds/red/pattern_id
	chmod 0664 /sys/class/leds/red/pattern_id
	chown system system /sys/class/leds/red/timed
	chmod 0664 /sys/class/leds/red/timed
	chown system system /sys/class/leds/red/time_on_off
	chmod 0664 /sys/class/leds/red/time_on_off

	#Set the premission for idle_time
	chown system graphics /sys/class/graphics/fb0/idle_time
	chmod 0664 /sys/class/graphics/fb0/idle_time

	# Set permission for cpubw devfreq node
	chown -h system /sys/class/devfreq/qcom,cpubw.30/min_freq
	chmod 0660 /sys/class/devfreq/qcom,cpubw.30/min_freq

# change preload directory permission for movetosd about preload app
service chmod_dp /system/bin/sh /system/etc/change_permission_preload.sh
    disabled
    oneshot

#Broadcast Service [hyun118.shin@lge.com]
service broadcast /system/bin/libbroadcast_server
    class main
    user media
    group system audio media graphics sdcard_rw
    socket dmb_socket stream 0660 media media

on property:init.svc.media=restarting
    restart broadcast

